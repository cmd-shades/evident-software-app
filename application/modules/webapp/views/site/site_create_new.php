<style type="text/css">
.restriction_row{
    border-radius: 12px;
}

span.restriction-item{
	display: inline-block;
    float: left;
    width: 25%;
	min-width: 50px;
}
</style>

<div id="add-new-site" class="row">
	<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
		<div class="left-container"> <!-- // Left container -->
			<div class="row">
				<h1>Add Site</h1>
			</div>
			<div class="row">

				<div class="step-name-wrapper current" data-group-name="Site Name">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Site Name</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="Site Address">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Site Address</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="Number of Rooms">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Number of Rooms</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="Site Contact Details">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Site Contact Details</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="System Integrator">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">System Integrator</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="System Type">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">System Type</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="Restrictions">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Restrictions</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="Charge Frequency">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Charge Frequency and Invoice Currency</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>

				<div class="step-name-wrapper" data-group-name="Territory and Time Zone">
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-name">Content Territory And Time Zone</div>
						</div>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
						<div class="row">
							<div class="step-status"><span class="tick_box el-hidden"><i class="fas fa-check"></i></span><span class="x-cross el-hidden"><i class="fas fa-times"></i></span></div>
						</div>
					</div>
				</div>


			</div>
		</div>
	</div> <!-- // Left container - END -->

	<div class="col-lg-9 col-md-9 col-sm-6 col-xs-12"> <!-- // Right container -->
		<div class="right-container">
			<div class="row">
				<div class="col-lg-9 col-lg-offset-3 col-md-9 col-md-offset-3 col-sm-6 col-sm-offset-3 col-xs-12 col-xs-offset-0">
					<form id="site-creation-form" >
						<input type="hidden" name="page" value="details" />
						<div class="row">
							<div class="site_creation_panel1 col-md-6 col-sm-12 col-xs-12" data-panel-index = "0">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What's the site name?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel1-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Site name</label>
										<input name="site_details[site_name]" class="form-control required" type="text" value="" placeholder="Site name..."  />

										<label class="input-group-addon el-hidden">Site Reference Code</label>
										<input name="site_details[site_reference_code]" class="form-control required" type="text" value="" placeholder="Site Reference Code"  />

									</div>

									<div class="row">
										<div class="col-lg-6 col-lg-offset-6 col-md-6 col-md-offset-6 col-sm-6 col-sm-offset-6 col-xs-12">
											<button class="btn-block btn-next" data-currentpanel="site_creation_panel1" id="check-reference-button" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel2 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "1">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What is the site address?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel2-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Site Address</label>
										<input name="site_address[fulladdress]" class="form-control required" type="text" value="" placeholder="Site Address *" />
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Site Country</label>
										<?php
										if( !empty( $territories ) ){ ?>
											<select name="site_address[site_territory_id]" class="form-control">
												<option value="">Please select</option>
												<?php
												foreach( $territories as $territory_id => $row ){ ?>
													<option value="<?php echo $row->territory_id; ?>"><?php echo ( !empty ( $row->country ) ) ? ucwords( $row->country ) : '' ; ?></option>
												<?php
												} ?>
											</select>
										<?php
										} else { ?>
											<input name="site_address[site_territory_id]" class="form-control required" type="text" value="" placeholder="Site Country *" />
										<?php
										}?>
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel2" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel2" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel3 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "2">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What is the number of rooms?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel3-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Number of Rooms</label>
										<input name="site_details[number_of_rooms]" class="form-control required" type="text" value="" placeholder="Number of Rooms" />
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel3" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel3" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel4 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "3">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What are the contact details?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel4-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Contact Name</label>
										<input name="site_contact[contact_full_name]" class="form-control" type="text" value="" placeholder="Contact Name" />
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Telephone Number</label>
										<input name="site_contact[telephone_number]" class="form-control" type="text" value="" placeholder="Telephone Number of Contact Person" />
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Email</label>
										<input name="site_contact[email]" class="form-control" type="text" value="" placeholder="Email" />
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Skype</label>
										<input name="site_contact[skype]" class="form-control" type="text" value="" placeholder="Skype Details" />
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel4" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel4" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel5 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "4">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">System Integrator and Operating Company</legend>
										</div>

										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel5-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<select name="site_details[system_integrator_id]" class="form-control">
											<?php 
											if( !empty( $system_integrators ) ){ ?>
												<option value="">System Integrator</option>
												<?php 
												foreach( $system_integrators as $integrator ){ ?>
													<option value="<?php echo $integrator->system_integrator_id; ?>"><?php echo ( !empty ( $integrator->integrator_name ) ) ? ucwords( $integrator->integrator_name ) : '' ; ?></option>
												<?php 
												}
											} ?>
										</select>
									</div>

									<div class="input-group form-group container-full">
										<select name="site_details[operating_company_id]" class="form-control">
											<option value="">Operating Company</option>
											<?php
											if( !empty( $operating_company ) ){
												foreach( $operating_company as $op_company ){ ?>
													<option value="<?php echo $op_company->system_integrator_id; ?>"><?php echo ( !empty ( $op_company->integrator_name ) ) ? ucwords( $op_company->integrator_name ) : '' ; ?></option>
												<?php
												}
											} ?>
										</select>
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel5" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel5" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel6 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "5">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What is the System Type?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel6-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<?php
										if( !empty( $systems ) ){ ?>
											<select name="site_details[system_type_id]" class="form-control">
												<option value="">Please select</option>
												<?php foreach( $systems as $row ){?>
													<option value="<?php echo ( !empty( $row->system_type_id ) ) ? $row->system_type_id : ''; ?>" title="<?php echo ( !empty( $row->name ) ) ? $row->name : '' ?>"><?php echo ( !empty( $row->name ) ) ? $row->name : '' ?></option>
												<?php } ?>
											</select>
										<?php
										} else { ?>
											<p>There are no system types. Please add new using the System module</p>
										<?php
										} ?>
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel6" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel6" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>


							<div class="site_creation_panel7 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "6">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What are the Restrictions?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel7-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
									<?php if( !empty( $age_rating ) ){ ?>
										<div class="restriction_row input-field" style="height: auto;">
											<?php
											foreach( $age_rating as $key => $row ){ ?>
												<span class="restriction-item">
													<input name="site_details[restrictions][]" type="checkbox" id="restrictions_<?php echo (!empty( $row->age_rating_id ) ) ? $row->age_rating_id : '' ; ?>" value="<?php echo (!empty( $row->age_rating_id ) ) ? $row->age_rating_id : '' ; ?>" title="<?php echo (!empty( $row->age_rating_desc ) ) ? $row->age_rating_desc : '' ; ?>" />
													<label for="restrictions_<?php echo (!empty( $row->age_rating_id ) ) ? $row->age_rating_id : '' ; ?>"><?php echo (!empty( $row->age_rating_name ) ) ? $row->age_rating_name : '' ; ?></span>
												</span>
											<?php
											} ?>
										</div>
									<?php } ?>
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel7" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel7" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>



						<div class="site_creation_panel8 col-md-6 col-sm-12 col-xs-12 el-hidden" data-panel-index = "7">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What is the Charge Frequency?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel8-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<select name="site_details[charge_frequency_id]" class="form-control">
											<option value="">Charge Frequency</option>
												<?php
												if( !empty( $charge_frequencies ) ){
													foreach( $charge_frequencies as $row ){ ?>
														<option value="<?php echo ( !empty( $row->setting_id ) ) ? $row->setting_id : ''; ?>" title="<?php echo ( !empty( $row->value_desc ) ) ? $row->value_desc : '' ?>"><?php echo ( !empty( $row->setting_value ) ) ? $row->setting_value : '' ; ?></option>
													<?php
													}
												} ?>
										</select>
									</div>

									<div class="input-group form-group container-full">
										<select name="site_details[invoice_to]" class="form-control">
											<option value="">Invoice To</option>
												<?php
												if( !empty( $invoice_to ) ){
													foreach( $invoice_to as $inv_row ){ ?>
														<option value="<?php echo ( !empty( $inv_row ) ) ? $inv_row : ''; ?>" title="<?php echo ( !empty( $inv_row ) ) ? $inv_row : '' ?>"><?php echo ( !empty( $inv_row ) ) ? ucwords( $inv_row ) : '' ; ?></option>
													<?php
													}
												} ?>
										</select>
									</div>

									<div class="input-group form-group container-full">
										<?php
										if( !empty( $invoice_currencies ) ){ ?>
											<select name="site_details[invoice_currency_id]" class="form-control">
												<option value="">Invoice Currency</option>
												<?php foreach( $invoice_currencies as $row ){?>
													<option value="<?php echo ( !empty( $row->setting_id ) ) ? $row->setting_id : ''; ?>" title="<?php echo ( !empty( $row->value_desc ) ) ? $row->value_desc : '' ?>"><?php echo ( !empty( $row->setting_value ) ) ? $row->setting_value : '' ?></option>
												<?php } ?>
											</select>
										<?php
										} else { ?>
											<input name="site_details[invoice_currency_id]" type="text" value="" placeholder="Invoice Currency ID" />
										<?php
										} ?>
									</div>


									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel8" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel8" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel9 col-md-6 col-sm-12 col-xs-12" style="display:none;" data-panel-index = "8">
								<div class="slide-group">
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<legend class="legend-header">What is the Content Territory and Time Zone?</legend>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<h6 class="error_message pull-right" id="site_creation_panel9-errors"></h6>
										</div>
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Content Territory</label>

										<?php
										if( !empty( $territories ) ){ ?>
											<select name="site_details[content_territory_id]" class="form-control">
												<option value="">Content Territory</option>
												<?php
												foreach( $territories as $territory_id => $row ){ ?>
													<option value="<?php echo $row->territory_id; ?>" <?php echo ( !empty( $content_details->territory_id ) && ( $content_details->territory_id == $row->territory_id ) ) ? 'selected="selected"' : "" ; ?>><?php echo ( !empty ( $row->country ) ) ? ucwords( $row->country ) : '' ; ?></option>
												<?php
												} ?>
											</select>
										<?php
										} else { ?>
											<input name="site_details[content_territory_id]" type="text" value="" placeholder="Content Territory ID" />
										<?php
										} ?>
									</div>

									<div class="input-group form-group container-full">
										<label class="input-group-addon el-hidden">Time Zone</label>

										<?php
										if( !empty( $time_zones ) ){ ?>
											<select name="site_details[time_zone_id]" class="form-control">
												<option value="">Time Zone</option>
												<?php
												foreach( $time_zones as $key => $row ){ ?>
													<option value="<?php echo $row->time_zone_id; ?>"><?php echo ( !empty ( $row->tz_db_name ) ) ? ucwords( $row->tz_db_name ) : '' ; ?></option>
												<?php
												} ?>
											</select>
										<?php
										} else { ?>
											<input name="site_details[time_zone_id]" type="text" value="" placeholder="Time Zone ID" />
										<?php
										} ?>
									</div>

									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel9" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-next site-creation-steps" data-currentpanel="site_creation_panel9" type="button">Next</button>
										</div>
									</div>
								</div>
							</div>

							<div class="site_creation_panel10 col-md-6 col-sm-12 col-xs-12" style="display:none" data-panel-index = "9">
								<div class="slide-group">
									<legend>Do you have any additional notes for this site?</legend>
									<div class="row">
										<div class="col-md-12 col-sm-12 col-xs-12 ">
											<textarea class="form-control" name="site_details[site_notes]"></textarea>
										</div>
									</div>
									<br/>
									<div class="row">
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button class="btn-block btn-back" data-currentpanel="site_creation_panel10" type="button">Back</button>
										</div>
										<div class="col-md-6 col-sm-6 col-xs-12">
											<button id="create-site-btn" class="btn-block btn-flow btn-next" type="button">Submit</button>
										</div>
									</div>
								</div>
							</div>

						</div>
					</form>
				</div>
			</div>
		</div>
	</div> <!-- // Right container - END -->
</div>

<script type="text/javascript">
$(document).ready(function(){
		$( "#site-creation-form" ).on( "change", "select[name='site_details[system_integrator_id]']", function(){
		var integratorId = $( this ).val();

		if( parseInt( integratorId ) > 0 ){

			$( "select[name='site_details[system_type_id]'] option:gt(0)" ).remove();

			$.ajax({
				url:"<?php echo base_url( 'webapp/site/get_systems_by_integrator/' ); ?>",
				method:"POST",
				data: {
					integrator_id:integratorId,
				},
				dataType: 'json',
				success: function( data ){
					if( data.systems ){
						$( "select[name='site_details[system_type_id]']" ).append( data.systems );
					} else {
						swal({
							type: 'error',
							title: data.status_msg
						})
					}
				}
			});
		} else {
		}
	});
	
	
	
	function validEmail( email ){
		var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
		return pattern.test( email );
	}


	function validPhone( phone ){
		var pattern = /([0-9]{10})|(\([0-9]{3}\)\s+[0-9]{3}\-[0-9]{4})/;
		// if spaces allowed
		var phone = phone.replace(/\s/g, "" );
		return pattern.test( phone );
	}


	$( ".site-creation-steps" ).click( function(){
		//Clear errors first
		$( '.error_message' ).each( function(){
			$( this ).text( '' );
		});

		var currentpanel = $(this).data( "currentpanel" );
		var inputs_state = check_inputs( currentpanel );
		if( inputs_state ){
			//If name attribute returned, auto focus to the field and display arror message
			$( '[name="'+inputs_state+'"]' ).focus();
			var labelText = $( '[name="'+inputs_state+'"]' ).parent().find( 'label' ).text();
			$( '#'+currentpanel+'-errors' ).text( ucwords( labelText ) +' is a required' );
			return false;
		}
		panelchange( "."+currentpanel )
		return false;
	});

	//** Validate any inputs that have the required class, if empty return the name attribute **/
	function check_inputs( currentpanel ){

		var result = false;
		var panel = "." + currentpanel;

		$( $( panel + " .required" ).get().reverse() ).each( function(){
			var fieldName = '';
			var inputValue = $( this ).val();
			if( ( inputValue == false ) || ( inputValue == '' ) || ( inputValue.length == 0 ) ){
				fieldName = $(this).attr( 'name' );
				result = fieldName;
				return result;
			}
		});

		if( currentpanel == "site_creation_panel4" ){

			// phone validation
			var phone = $( "[name='site_contact[telephone_number]']" ).val();
			if( !validPhone( phone ) ) {
				alert( 'Please enter valid phone number (only digits or spaces, min 10)' );
				fieldName = $( "[name='site_contact[telephone_number]']" ).attr( 'name' );
				result = fieldName;
				return result;
			}

			// email validation
			var email = $( "[name='site_contact[email]']" ).val();
			if( !validEmail( email ) ) {
				alert( 'Please enter valid email' );
				fieldName = $( "[name='site_contact[email]']" ).attr( 'name' );
				result = fieldName;
				return result;
			}
		}

		return result;
	}

	$(".btn-next").click( function(){

		var currentpanel = $("."+$(this).data( "currentpanel" ));
		prev_group_is_valid = true;

		currentpanel.find("input").each(function(i, input_element) {
			if ($(input_element).hasClass("required")) {
				if ($(input_element).val() == "") {
					prev_group_is_valid = false;
				}
			}
		});

		current_panel_id = $("."+$(this).data( "currentpanel" )).attr("data-panel-index")

		if(prev_group_is_valid){

			$($(".tick_box")[current_panel_id]).removeClass( "el-hidden" )
			$($(".x-cross")[current_panel_id]).addClass( "el-hidden" )
		} else {
			$($(".x-cross")[current_panel_id]).removeClass( "el-hidden" )
			$($(".tick_box")[current_panel_id]).addClass( "el-hidden" )
		}

	});

	$( ".btn-back" ).click( function(){
		var currentpanel = $( this ).data( "currentpanel" );
		go_back( "." + currentpanel )
		return false;
	});

	function panelchange( changefrom ){
		var panelnumber = parseInt( changefrom.match(/\d+/) )+parseInt(1);
		var changeto = ".site_creation_panel" + panelnumber;
		$( changefrom ).hide( "slide", {direction : 'left'}, 500 );
		$( changeto ).delay( 600 ).show( "slide", {direction : 'right'},500 );
		return false;
	}

	function go_back( changefrom ){
		var panelnumber = parseInt( changefrom.match(/\d+/) )-parseInt(1);
		var changeto = ".site_creation_panel" + panelnumber;
		$( changefrom ).hide( "slide", {direction : 'right'}, 500 );
		$( changeto ).delay( 600 ).show( "slide", {direction : 'left'},500 );
		return false;
	}

	//Submit site form
	$( '#create-site-btn' ).click( function( e ){
		e.preventDefault();
		var formData = $( '#site-creation-form' ).serialize();

		swal({
			title: 'Confirm new site creation?',
			showCancelButton: true,
			confirmButtonColor: '#5CB85C',
			cancelButtonColor: '#9D1919',
			confirmButtonText: 'Yes'
		}).then( function (result) {
			if ( result.value ) {
				$.ajax({
					url:"<?php echo base_url( 'webapp/site/create_site/' ); ?>",
					method:"POST",
					data:formData,
					dataType: 'json',
					success:function( data ){
						if( data.status == 1 && ( data.site !== '' ) ){

							var newSiteId = data.site.site_id;

							swal({
								type: 'success',
								title: data.status_msg,
								showConfirmButton: false,
								timer: 2000
							})
							window.setTimeout( function(){
								location.href = "<?php echo base_url('webapp/site/profile/'); ?>"+newSiteId;
							}, 2000 );
						}else{
							swal({
								type: 'error',
								title: data.status_msg
							})
						}
					}
				});
			}else{
				$( ".site_creation_panel14" ).hide( "slide", { direction : 'left' }, 500 );
				go_back( ".site_creation_panel2" );
				return false;
			}
		}).catch( swal.noop )
	});

	$( "[name = 'site_details[site_name]' ]" ).on("input", function() {
		title_text = $( "[ name = 'site_details[site_name]']" ).val();
		if(title_text.length > 255) title_text = title_text.substring(0,254);
		title_text = title_text.replace(/[^a-z0-9]+/gi, "").toLowerCase();
		asset_input = $( "[name = 'site_details[site_reference_code]' ]" ).val(title_text);
	});

	$("#check-reference-button").click( function( e ){

		var ref = $( "[name = 'site_details[site_reference_code]' ]" ).val()

		if(!(ref == "")){
		$.ajax({
				url:"<?php echo base_url('webapp/site/check_reference/'); ?>",
				method:"POST",
				data:{
					"reference": ref,
					"module": "site"
				},
				dataType: 'json',
				success:function( data ){
					if( ( data.status == 1 ) ){
						swal({
							type: 'error',
							title: data.status_msg,
							timer: 2000
						})
					} else {
						/* swal({
							type: 'success',
							title: data.status_msg,
							timer: 2000
						}) */

						panelchange( ".site_creation_panel1")

					}
				}
			});

		} else {
			swal({
				type: 'error',
				title: "Reference can not be empty!",
				timer: 2000
			})
		}
	});
});
</script>